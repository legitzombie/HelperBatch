@echo off

REM  ▄▄▄██▀▀▀▄▄▄       ███▄ ▄███▓▓█████   ██████
REM    ▒██  ▒████▄    ▓██▒▀█▀ ██▒▓█   ▀ ▒██    ▒
REM    ░██  ▒██  ▀█▄  ▓██    ▓██░▒███   ░ ▓██▄
REM ▓██▄██▓ ░██▄▄▄▄██ ▒██    ▒██ ▒▓█  ▄   ▒   ██▒
REM  ▓███▒   ▓█   ▓██▒▒██▒   ░██▒░▒████▒▒██████▒▒
REM  ▒▓▒▒░   ▒▒   ▓▒█░░ ▒░   ░  ░░░ ▒░ ░▒ ▒▓▒ ▒ ░
REM  ▒ ░▒░    ▒   ▒▒ ░░  ░      ░ ░ ░  ░░ ░▒  ░ ░
REM  ░ ░ ░    ░   ▒   ░      ░      ░   ░  ░  ░
REM  ░   ░        ░  ░       ░      ░  ░      ░
REM
REM          ▄▄▄█████▓ ██░ ██ ▓█████
REM          ▓  ██▒ ▓▒▓██░ ██▒▓█   ▀
REM          ▒ ▓██░ ▒░▒██▀▀██░▒███
REM          ░ ▓██▓ ░ ░▓█ ░██ ▒▓█  ▄
REM            ▒██▒ ░ ░▓█▒░██▓░▒████▒
REM            ▒ ░░    ▒ ░░▒░▒░░ ▒░ ░
REM              ░     ▒ ░▒░ ░ ░ ░  ░
REM            ░       ░  ░░ ░   ░
REM                    ░  ░  ░   ░  ░
REM
REM  ██░ ██  ▄▄▄       ▄████▄   ██ ▄█▀▓█████  ██▀███
REM ▓██░ ██▒▒████▄    ▒██▀ ▀█   ██▄█▒ ▓█   ▀ ▓██ ▒ ██▒
REM ▒██▀▀██░▒██  ▀█▄  ▒▓█    ▄ ▓███▄░ ▒███   ▓██ ░▄█ ▒
REM ░▓█ ░██ ░██▄▄▄▄██ ▒▓▓▄ ▄██▒▓██ █▄ ▒▓█  ▄ ▒██▀▀█▄
REM ░▓█▒░██▓ ▓█   ▓██▒▒ ▓███▀ ░▒██▒ █▄░▒████▒░██▓ ▒██▒
REM  ▒ ░░▒░▒ ▒▒   ▓▒█░░ ░▒ ▒  ░▒ ▒▒ ▓▒░░ ▒░ ░░ ▒▓ ░▒▓░
REM  ▒ ░▒░ ░  ▒   ▒▒ ░  ░  ▒   ░ ░▒ ▒░ ░ ░  ░  ░▒ ░ ▒░
REM  ░  ░░ ░  ░   ▒   ░        ░ ░░ ░    ░     ░░   ░
REM  ░  ░  ░      ░  ░░ ░      ░  ░      ░  ░   ░
REM                   ░

setlocal enabledelayedexpansion

set "runbat=%~dp0..\Run.bat"

python --version >nul 2>&1
if %errorlevel%==0 (
    exit /b 0
)

echo [INFO] Python not found. Downloading installer...

for %%i in ("%TEMP%\python_installer.exe") do set "temp_installer=%%~fi"
curl -L -o "!temp_installer!" https://www.python.org/ftp/python/3.12.3/python-3.12.3-amd64.exe

echo [INFO] Installing Python... (may prompt for UAC)
"!temp_installer!" /quiet 

set "pyUserDir=%LOCALAPPDATA%\Programs\Python\Python312"
set "pyExe=%pyUserDir%\python.exe"
set "pyScripts=%pyUserDir%\Scripts"

if not exist "!pyExe!" (
    echo [ERROR] Python installation failed.
    pause
    exit /b 1
)

for /f "tokens=2* delims= " %%A in ('reg query "HKCU\Environment" /v Path 2^>nul') do set "currentPath=%%B"

echo "!currentPath!" | find /i "!pyUserDir!" >nul
if errorlevel 1 (
    set "newPath=!currentPath!;!pyUserDir!;!pyScripts!"
    reg add "HKCU\Environment" /v Path /d "!newPath!" /f >nul
    echo [INFO] Updated user PATH to include Python.
	exit /b 123
) 
setx PATH "!pyUserDir!;!pyScripts!;!PATH!" >nul

:done
echo [SUCCESS] Python is now installed and available.
pause
exit /b 0

